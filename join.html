<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Become a Student - LimiPlake</title>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            emailjs.init("oAbObyX_TdjrNh-4A"); // Your EmailJS user ID

            document.getElementById("becomeAStudent").addEventListener("click", function (event) {
                event.preventDefault();

                let cdt = getPayment()
                document.getElementById("payHold").textContent = "Payment: $" + cdt + "/week with a fee of 160.09 after being taught."
                
                
                // ðŸŸ¢ Get the latest values from inputs
                var firstName = document.getElementById("firstname").value;
                var lastName = document.getElementById("lastname").value;
                var fullName = firstName + " " + lastName;

                let paramsme = {
                    to_email: "anhad@limiplake.com",
                    name: fullName,
                    email: document.getElementById("email").value,
                    pin_code: document.getElementById("pin").value,
                    part: document.getElementById("parts").value
                };

                let paramscli = {
                    to_name: firstName,
                    full_name: fullName,
                    email: document.getElementById("email").value,
                    pin: document.getElementById("pin").value,
                    to_email: document.getElementById("email").value,
                    from_name: "LimiPlake",
                    from_email: "no-replying@limiplake.com",
                    part: document.getElementById("parts").value
                };

                console.log("Params to be sent:", paramsme);

                emailjs.send("service_1l2p3li5", "template_31oby7l", paramsme)
                    .then(function (response) {
                        console.log("Email sent successfully:", response);
                        window.location.href = "/joined";
                    }, function (error) {
                        console.error("Couldn't make a student: lprr jn (emjs", error + ") Do not visit any of these links; instead, email anhad@limiplake.com this exact error.");
                        alert("Couldn't make you a student: lprr jn (emjs " + JSON.stringify(error) + ") Do not visit any of these links; instead, email anhad@limiplake.com this exact error.");
                    });

                emailjs.send("service_1l2p3li5", "template_douh9uo", paramscli)
                    .then(function (response) {
                        console.log("Client email sent successfully:", response);
                        window.location.href = "/joined";
                    }, function (error) {
                        console.error("Couldn't make a student: lprr jn (emjs ", error + ") Do not visit any of these links; instead, email anhad@limiplake.com this exact error.");
                        alert("Couldn't make you a student: lprr jn (emjs " + JSON.stringify(error) + ") Do not visit any of these links; instead, email anhad@limiplake.com this exact error.");
                    });
            });
        });

        function getPayment() {
            let pym = 9.33;   // base default payment
            let fee = "160.09";

            // --- Registerer ---
            let registerer = document.getElementById("rgst").value;
            if (registerer === "For my child") {
                pym -= 0.02;
            }

            // --- Program ---
            let program = document.getElementById("parts").value;
            if (program === "LimiMake") {
                pym += 0.01;
            } else if (program === "Both LimiPlay and LimiMake") {
                pym += 1.00;
            } else if (program.includes("Further Courses")) {
                pym += 2.10;
            }

            // --- Starting Level (only applies if LimiMake or Both) ---
            let level = parseInt(document.getElementById("level").value);
            if (program === "LimiMake" || program === "Both LimiPlay and LimiMake") {
                switch (level) {
                    case 2: pym += 1.01; break;
                    case 3: pym += 2.01; break;
                    case 4: pym += 3.01; break;
                    case 5: pym += 4.01; break;
                    case 6: pym += 5.01; break;
                    case 7: pym += 6.01; break;
                    default: break; // Level 1 adds nothing
                }
            }

            // --- Way to get to us ---
            let way = document.getElementById("way").value;
            if (way === "Online Meetings") {
                pym += 0.51;
            } else if (way === "Online via LimiMake Lessons") {
                pym += 1.45;
            }

            // convert pym to string before returning
            let payment = String(pym.toFixed(2));
            return payment;
        }
    </script>
</head>
<body>
    <h2>Become a Student</h2>
    <form>
        <label for="firstname">First Name:</label>
        <input type="text" id="firstname" name="firstname" required><br><br>

        <label for="lastname">Last Name:</label>
        <input type="text" id="lastname" name="lastname"><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email"><br><br>

        <label for="pin">Choose a PIN code (4 digit):</label>
        <input type="text" id="pin" name="pin" required><br><br>

        <label for="parts">Choose LimiPlay (piano) or LimiMake (coding):</label>
        <select id="parts" required name="part">
            <option value="" disabled selected>Choose...</option>
            <option value="LimiPlay">LimiPlay</option>
            <option value="LimiMake">LimiMake</option>
            <option value="Both LimiPlay and LimiMake">Both LimiPlay and LimiMake</option>
            <option value="LimiPlay Further Courses">LimiPlay Further Courses</option>
            <option value="LimiMake Further Courses">LimiMake Further Courses</option>
        </select><br><br>

        <label for="rgst">Registerer:</label>
        <select id="rgst" name="rgst" required>
            <option value="" disabled selected>Choose...</option>
            <option value="For myself">For myself</option>
            <option value="For my child">For my child</option>
        </select><br><br>

        <label for="level">Starting Level (if LimiMake):</label>
        <select id="level" name="level">
            <option value="1" selected>Level 1</option>
            <option value="2">Level 2</option>
            <option value="3">Level 3</option>
            <option value="4">Level 4</option>
            <option value="5">Level 5</option>
            <option value="6">Level 6</option>
            <option value="7">Level 7</option>
        </select><br><br>

        <label for="way">Way to get to us:</label>
        <select id="way" name="way">
            <option value="" disabled selected>Choose...</option>
            <option value="Online Meetings">Online Meetings</option>
            <option value="Online via LimiMake Lessons">Online via LimiMake Lessons</option>
        </select><br><br>

        <button id="becomeAStudent" type="submit">
            Click here to submit your info and become a student
        </button>
    </form>
</body>
</html>
